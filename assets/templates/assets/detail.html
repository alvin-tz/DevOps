{% extends 'assetsbase.html' %}
{% load staticfiles %}
{% block title %}服务器详情{% endblock %}

{% block css %}
    <!-- Theme style -->
    <link rel="stylesheet" href="{% static 'dist/css/AdminLTE.min.css' %}">
    <!-- AdminLTE Skins. Choose a skin from the css/skins folder instead of downloading all of them to reduce the load. -->
    <link rel="stylesheet" href="{% static 'dist/css/skins/_all-skins.min.css' %}">
    <!-- Xterm -->
    <link rel="stylesheet" href="{% static 'plugins/xterm/xterm.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/xterm/style.css' %}">
    <style>
        .hide {
            display: none;
        }
    </style>
    <style>
        .terminal {
            border: #000 solid 5px;
            font-family: cursive;
            font-size: 15px;
            background: #000;
            box-shadow: rgba(0, 0, 0, 0.8) 2px 2px 20px;
        }

        .reverse-video {
            color: #000;
            background: #f0f0f0;
        }
    </style>
{% endblock %}

{% block content %}
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>
            服务器详情
            <small>server info</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="{% url 'assets:dashboard' %}"><i class="fa fa-dashboard"></i>主页</a></li>
            <li><a href="{% url 'assets:index' %}"><i class="fa fa-table"></i>服务器总表</a></li>
            <li class="active">服务器详情</li>
        </ol>
    </section>

    <!-- Main content -->
    <section class="content">
        <!-- Default box -->
        <div class="box" id="detail">
            <div class="box-header with-border">
                <h3 class="box-title"><strong class="btn btn-block btn-primary btn-lg">服务器：{{ server.alias }}</strong></h3>
{#                <a class="btn btn-success" id="webssh" onclick='showhidendiv("msg")'><strong>远程连接服务器</strong></a>#}
                <a class="btn btn-success" id="lianjie" onclick='post_data({{ server.id }})' href="#terminal"><strong>远程连接服务器</strong></a>
{#                <a class="btn btn-success" id="webssh" onclick='openTerminal()' href="{% url 'assets:connect' server.id %}"><strong>远程连接服务器</strong></a>#}
                <a class="btn btn-info" href="{% url 'assets:modify' server.id %}"><strong>修改服务器信息</strong></a>
                <a class="btn btn-warning" href="{% url 'assets:deleteserver' server.id %}" onclick="return confirmd()"><strong>删除服务器</strong></a>
                <div class="box-tools pull-right">
                    <button type="button" class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse">
                        <i class="fa fa-minus"></i>
                    </button>
                    <button type="button" class="btn btn-box-tool" data-widget="remove" data-toggle="tooltip" title="Remove">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
            </div>
            <div class="box-body">
                <h4><b>详细信息：</b></h4>

                {% csrf_token %}

                <table class="table table-bordered" style="border: 1px solid deepskyblue">
                    <tbody>
                        <tr>
                            <td><b>主机别名</b></td>
                            <td>{{ server.alias }}</td>
                        </tr>
                        <tr>
                            <td>主机名</td>
                            <td>{{ server.hostname|default_if_none:"-" }}</td>
                        </tr>
                        <tr>
                            <td>操作系统类型</td>
                            <td>{{ server.os_type|default_if_none:"-" }}</td>
                        </tr>
                        <tr>
                            <td>操作系统版本</td>
                            <td>{{ server.os_release|default_if_none:"-" }}</td>
                        </tr>
                        <tr>
                            <td>所属环境</td>
                            <td>{{ server.system|default_if_none:"others" }}</td>
                        </tr>
                        <tr>
                            <td>外网IP</td>
                            <td>{{ server.extranet_IP|default_if_none:"-" }}</td>
                        </tr>
                        <tr>
                            <td>内网IP</td>
                            <td>{{ server.intranet_IP|default_if_none:"-" }}</td>
                        </tr>
                        <tr>
                            <td>CPU数量</td>
                            <td>{{ server.cpu|default_if_none:"-" }}</td>
                        </tr>
                        <tr>
                            <td>内存大小(GB)</td>
                            <td>{{ server.ram|default_if_none:"-" }}</td>
                        </tr>
                        <tr>
                            <td>磁盘大小(GB)</td>
                            <td>{{ server.disk|default_if_none:"-" }}</td>
                        </tr>
                        <tr>
                            <td>网络带宽(Mbps)</td>
                            <td>{{ server.network_bandwidth|default_if_none:"-" }}</td>
                        </tr>
                        <tr>
                            <td>SSH端口</td>
                            <td>{{ server.ssh_port|default_if_none:"-" }}</td>
                        </tr>
                        <tr>
                            <td>其他远程登录用户</td>
                            <td>{{ server.ssh_user_other|default_if_none:"-" }}</td>
                        </tr>
                        <tr>
                            <td>最后修改时间</td>
                            <td>{{ server.modified_time|date:"Y/m/d [H:m:s]" }}</td>
                        </tr>
                    </tbody>
                </table>

            </div><!-- /.box-body -->
            <div class="box-footer">
                <i class="fa fa-angle-double-left"></i>&nbsp;&nbsp;<a class="btn btn-primary" href="{% url 'assets:index' %}"><strong>返回服务器列表页</strong></a>
{#                <a class="btn btn-primary pull-right" href="{% url 'assets:modify' server.id %}"><strong>修改服务器信息</strong></a>#}
{#                <a class="btn btn-primary pull-right" href="{% url 'assets:deleteserver' server.id %}"><strong>删除服务器</strong></a>#}
                &nbsp;&nbsp;
{#                <a class="btn btn-primary pull-right" href="/assets/modify"><strong>修改服务器信息</strong></a>#}
            </div><!-- /.box-footer-->
        </div><!-- /.box -->
    </section><!-- /.content -->

    <section class="content">
{#        <div id="xterm" style="display: none;" class="box">#}
{#        <div class="box">#}
{#            <div class="box-header with-border">#}
{#                <h3 class="box-title"><a><strong class="btn btn-block btn-primary btn-lg">远程连接到服务器{{ server.alias }}</strong></a></h3>#}
{#            </div>#}
{#            <input type="text" id="message" value="Hello, World!"/>#}
{#            <button type="button" id="connect_websocket">连接 websocket</button>#}
{#            <button type="button" id="send_message">发送 message</button>#}
{#            <button type="button" id="close_websocket">关闭 websocket</button>#}
{#            <h1>Received Messages</h1>#}
{#            <div id="messagecontainer"></div>#}
{#            <div class="box-body" id="term">#}
{#                <a class="btn btn-success">webssh</a>#}
{#            </div>#}
            <div id="django-webssh-terminal" class="hide">
                <div id="terminal"></div>
            </div>
{#        </div>#}
    </section>

{% endblock %}


{% block script %}
    <!-- Xterm -->
    <script src="{% static 'plugins/xterm/xterm.js' %}"></script>
    <script src="{% static 'plugins/webssh.js' %}"></script>
    <script src="{% static 'plugins/luffy.js' %}"></script>
{#    <script>#}
{#        var socket = new WebSocket('ws://' + window.location.host + '/ws/');#}
{##}
{#        socket.onopen = function () {#}
{##}
{#            var term = new Terminal();#}
{#            term.open(document.getElementById('terms'));#}
{##}
{#            term.on('data', function (data) {#}
{#                console.log(data);#}
{#                socket.send(data);#}
{#            });#}
{##}
{#            socket.onmessage = function (msg) {#}
{#                console.log(msg);#}
{#                console.log(msg.data);#}
{#                term.write(msg.data);#}
{#            };#}
{#            socket.onerror = function (e) {#}
{#                console.log(e);#}
{#            };#}
{##}
{#            socket.onclose = function (e) {#}
{#                console.log(e);#}
{#                term.destroy();#}
{#            };#}
{#        };#}
{#    </script>#}

{#    <script type="text/javascript">#}
{#        $(function () {#}
{#            $('#connect_websocket').click(function () {#}
{#                if (window.s) {#}
{#                    window.s.close()#}
{#                }#}
{#                /*创建socket连接*/#}
{#                var socket = new WebSocket("ws://" + window.location.host + "/echo/");#}
{#                socket.onopen = function () {#}
{#                    console.log('WebSocket open');//成功连接上Websocket#}
{#                };#}
{#                socket.onmessage = function (e) {#}
{#                    console.log('message: ' + e.data);//打印出服务端返回过来的数据#}
{#                    $('#messagecontainer').prepend('<p>' + e.data + '</p>');#}
{#                };#}
{#                // Call onopen directly if socket is already open#}
{#                if (socket.readyState == WebSocket.OPEN) socket.onopen();#}
{#                    window.s = socket;#}
{#                });#}
{#            $('#send_message').click(function () {#}
{#                //如果未连接到websocket#}
{#                if (!window.s) {#}
{#                    alert("websocket未连接.");#}
{#                } else {#}
{#                    window.s.send($('#message').val());//通过websocket发送数据#}
{#                }#}
{#            });#}
{#            $('#close_websocket').click(function () {#}
{#                if (window.s) {#}
{#                    window.s.close();//关闭websocket#}
{#                    console.log('websocket已关闭');#}
{#                }#}
{#            });#}
{##}
{#        });#}
{#    </script>#}

    <script type="text/javascript">
        function showhidendiv(msg) {
            var sbtitle=document.getElementById(msg);
            if (sbtitle){
                if (sbtitle.style.display=='none'){
                    sbtitle.style.display='block';
                }
                {#else {#}
                {#    sbtitle.style.display='none';#}
            }
        }
    </script>

{#    <script>#}
{#        function openTerminal(options) {#}
{#            //创建websocket通道#}
{#            var client = new IronSSHClient();#}
{#            copytext = false;#}
{##}
{##}
{#            var term = new Terminal(#}
{#                    {#}
{#                        cols: 80,#}
{#                        rows: 24,#}
{#                        handler: function (key) {#}
{#                            console.log(key);#}
{#                            if (copytext){#}
{#                                client.send(copytext);#}
{#                                copytext = false#}
{##}
{#                            }#}
{#                            client.send(key);#}
{##}
{##}
{##}
{#                        },#}
{#                        screenKeys: true,#}
{#                        useStyle: true,#}
{#                        cursorBlink: true#}
{#                    });#}
{#            term.open();#}
{#            $('.terminal').detach().appendTo('#term');#}
{#            term.resize(80,24)#}
{#            term.write("开始连接....");#}
{##}
{##}
{#            client.connect(#}
{#                    $.extend(options, {#}
{#                                onError: function (error) {#}
{#                                    term.write("错误：" + error + "\r\n");#}
{#                                },#}
{#                                onConnect: function () {#}
{#                                    term.write('\r');#}
{#                                },#}
{#                                onClose: function () {#}
{#                                    term.write("对方断开了连接......");#}
{#                                }, //term.destroy()#}
{#                                onData: function (data) {#}
{##}
{#                                    if (copytext){#}
{#                                        term.write(copytext);#}
{#                                        copytext = false#}
{#                                    }#}
{#                                    else {#}
{#                                        term.write(data)#}
{#                                    }#}
{#                                }#}
{#                            }#}
{#                    )#}
{#            );#}
{##}
{##}
{#        }#}
{#    </script>#}
{% endblock %}

{#{% block script %}#}
{#    <!-- SlimScroll -->#}
{#    <script src="{% static 'plugins/jquery-slimscroll/jquery.slimscroll.min.js' %}"></script>#}
{#    <!-- FastClick -->#}
{#    <script src="{% static 'plugins/fastclick/lib/fastclick.js' %}"></script>#}
{#    <!-- AdminLTE App -->#}
{#    <script src="{% static 'dist/js/adminlte.min.js' %}"></script>#}
{#    <!-- AdminLTE for demo purposes -->#}
{#    <script src="{% static 'dist/js/demo.js' %}"></script>#}
{#    <!-- page script -->#}
{#{% endblock %}#}